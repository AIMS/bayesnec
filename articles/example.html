<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>General usage • bayesnec</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="General usage">
<meta property="og:description" content="bayesnec">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">bayesnec</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/example.html">General usage</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/open-aims/bayesnec/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="example_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>General usage</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/open-aims/bayesnec/blob/master/vignettes/example.Rmd"><code>vignettes/example.Rmd</code></a></small>
      <div class="hidden name"><code>example.Rmd</code></div>

    </div>

    
    
<div id="bayesnec" class="section level1">
<h1 class="hasAnchor">
<a href="#bayesnec" class="anchor"></a><code>bayesnec</code>
</h1>
<p>The <code>bayesnec</code> is an R package to fit concentration(dose) - response curves to toxicity data, and derive No-Effect-Concentration (<em>NEC</em>), No-Significant-Effect-Concentration (<em>NSEC</em>), and Effect-Concentration (of specified percentage ‘x’, <em>ECx</em>) thresholds from non-linear models fitted using Bayesian MCMC fitting methods via <code>brms</code> <span class="citation">(Bürkner 2017; <span class="citeproc-not-found" data-reference-id="Burkner2018"><strong>???</strong></span>)</span> and <code>stan</code>. The package is an adaptation and extension of an initial package <code>jagsNEC</code> <span class="citation">(Fisher, Ricardo, and Fox 2020)</span> which as based on the <code>R2jags</code> package <span class="citation">(Su and Yajima 2015)</span> and <code>jags</code> <span class="citation">(Plummer 2003)</span>.</p>
</div>
<div id="background" class="section level1">
<h1 class="hasAnchor">
<a href="#background" class="anchor"></a>Background</h1>
<p>Bayesian model fitting can be difficult to automate across a broad range of usage cases, particularly with respect to specifying valid initial values and appropriate priors. This is one reason the use of Bayesian statistics for <em>NEC</em> estimation (or even <em>ECx</em> estimation) is not currently widely adopted across the broader ecotoxicological community, who rarely have access to specialist statistical expertise. The <code>bayesnec</code> package provides an accessible interface specifically for fitting <em>NEC</em> models and other concentration-response models using Bayesian methods. A range of models are specified based on the known distribution of the “concentration” or “dose” variable (the predictor, x) as well as the “response” (y) variable. The model formula, including priors and initial values required to call a <code>brms</code> model are automatically generated based on information contained in the supplied data. While the distribution of the x and y variables can be specified directly, <code>bayesnec</code> will automatically ‘guess’ the correct distribution to use based on the characteristics of the provided data.</p>
<p>This project started with an implementation of the <em>NEC</em> model based on that described in <span class="citation">(Fox 2010)</span> using R2jags. The package has been further generalised to allow a large range of response variables to be modelled using the appropriate statistical distribution. While the original <code>jagsNEC</code> implementation supported gaussian, poisson, binomial, gamma, negbin and beta response data <code>bayesnec</code> supports any of the <code>brms</code> families. We have since also further added a range of alternative <em>NEC</em> model types, as well as a range of typically used concentration-response models (such as 4-parameter logistic and weibull models) that have no <em>NEC</em> ‘step’ function but simply model the response as a smooth function of concentration, as can be fit using other commonly used frequentist packages such as <code>drc</code> <span class="citation">(Ritz et al. 2016)</span>.</p>
<p>Specific models can be fit directly using <code>bnec</code>. Alternatively it is possible to fit a a custom model set, specific model set or all of the available models. When multiple models are specified the <code>bnec</code> function returns a model weighted estimate of predicted posterior values, based on watanabe information criteria (WAIC) model weights, analogous to the way model weights are generated using AIC or AICc <span class="citation">(Burnham and Anderson 2002)</span>. It is also possible to obtain all individual model fits from the fitted <code>bayesnecfit</code> model object if required. Multi-model inference can be useful where there are a range of plausible models that could be used <span class="citation">(Burnham and Anderson 2002)</span> and has been recently adopted in ecotoxicology for SSD model inference <span class="citation">(Thorley and Schwarz 2018)</span>.</p>
<p>An additional endpoint has also been derived using Bayesian posterior predicted values to estimate the “No-Statistical-Effect-Concentration” as the concentration at which predicted values for each MCMC chain fall below a lower percentile bound (defined as <code>sig_val</code>) of the control, which is assumed to be the lowest treatment (x_var) concentration in the data. <em>NSEC</em> estimates are currently used to approximate <em>NEC</em> for models without a specific <em>NEC</em> step parameter (in <code>bayesnec</code> these have the prefix <code>ecx</code> in their model name).</p>
<p>Important information on the current package is contained in the <code>bayesnec</code> helpfiles.</p>
<p>This package is currently under development. We are keen on any feedback regarding usage, and especially bug reporting that includes an easy to run self contained reproducible example of unexpected behaviour or example model fits that fail to converge (have poor chain mixing) or yield other errors. Such information will hopefully help us towards building a more robust package. We cannot help troubleshoot issues if an easy to run reproducible example is not supplied.</p>
</div>
<div id="installation" class="section level1">
<h1 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h1>
<p>To install the latest version from GitHub (<a href="https://github.com/AIMS/bayesnec" class="uri">https://github.com/AIMS/bayesnec</a>) use:</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"remotes"</span>)
<span class="kw">remotes</span>::<span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span>(<span class="st">"AIMS/bayesnec"</span>)
</pre></div>
<p>To run this vignette we will also need some additional packages, which are made available via <code>tidyverse</code></p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="http://tidyverse.tidyverse.org">tidyverse</a></span>)
</pre></div>
</div>
<div id="examples" class="section level1">
<h1 class="hasAnchor">
<a href="#examples" class="anchor"></a>Examples</h1>
<div id="fitting-the-nec3param-model-using-bnec" class="section level2">
<h2 class="hasAnchor">
<a href="#fitting-the-nec3param-model-using-bnec" class="anchor"></a>Fitting the nec3param model using <code>bnec</code>
</h2>
<p>Here we include some examples showing how to use the package to fit an <em>NEC</em> model to binomial, proportional, count and continuous response (y) data. The examples are those used by Gerard Ricardo at: <a href="https://github.com/gerard-ricardo/NECs/blob/master/NECs" class="uri">https://github.com/gerard-ricardo/NECs/blob/master/NECs</a>. Here we show how to run the same <code>jags</code> models using the <code>bayesnec</code> package.</p>
<div id="binomial-data" class="section level3">
<h3 class="hasAnchor">
<a href="#binomial-data" class="anchor"></a>Binomial data</h3>
<p>The response variable <code>y</code> is considered to follow a binomial distribution when it is a count out of a total (such as the percentage survival of individuals, for example). First we read in the binomial example from <a href="https://pastebin.com/tools">pastebin</a>, prepare the data for analysis, and then inspect the dataset as well as the “concentration” or x variable, in this case <code>raw_x</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="kw">binom_data</span> <span class="op">&lt;-</span> <span class="st">"https://pastebin.com/raw/zfrUha88"</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span>(header = <span class="fl">TRUE</span>, dec = <span class="st">","</span>, stringsAsFactors = <span class="fl">FALSE</span>) <span class="op">%&gt;%</span>
  <span class="kw">dplyr</span>::<span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span>(raw_x = <span class="kw">raw.x</span>) <span class="op">%&gt;%</span>
  <span class="kw">dplyr</span>::<span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(raw_x = <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="kw">raw_x</span>)),
                log_x = <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(<span class="kw">raw_x</span>))

<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="kw">binom_data</span>)
</pre></div>
<pre><code>## 'data.frame':    48 obs. of  4 variables:
##  $ raw_x: num  0.1 0.1 0.1 0.1 0.1 0.1 6.25 6.25 6.25 6.25 ...
##  $ suc  : int  101 106 102 112 58 158 95 91 93 113 ...
##  $ tot  : int  175 112 103 114 69 165 109 92 99 138 ...
##  $ log_x: num  -2.3 -2.3 -2.3 -2.3 -2.3 ...</code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span>(<span class="kw">binom_data</span><span class="op">$</span><span class="kw">raw_x</span>)
</pre></div>
<pre><code>## [1]   0.1 400.0</code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span>(<span class="kw">binom_data</span><span class="op">$</span><span class="kw">raw_x</span>)
</pre></div>
<p><img src="example_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p>In this case for x, lowest concentration is 0.1 and the highest is 400. The data are right skewed and on the continuous scale. This type of distribution for the x data are common for concentration response experiments, where the x ‘concentration’ data are the concentration of contaminants, or dilutions. The current default in <code>bayesnec</code> is to estimate the appropriate distribution(s) and priors for both the <code>y_type</code> and <code>x_type</code> arguments, but it is possible to supply these arguments directly. We are going to model this with the x data on a log scale, as this is the scaling clearly used in the experimental design and the will provide more stable results.</p>
<p>The data are clearly binomial, with the column <code>suc</code>—indicating the number of ‘successes’ in the binomial call, with <code>tot</code> clearly indicating the number of trials.</p>
<p>The main ‘working’ function in <code>bayesnec</code> is the function <code>bnec</code>, which calls the other necessary functions and fits the <code>brms</code> model. We run <code>bnec</code> by supplying <code>data</code>: a data.frame containing the data for the model fitting, here, <code>binom_data</code>; <code>x_var</code>: the name of the column in <code>data</code> which contains the concentration data or ‘x’ data to be used in the <em>NEC</em> model fit, and <code>y_var</code>: the name of the column in <code>data</code> which contains the response or ‘y’ data to be used in the <em>NEC</em> model fit. In our example here, as this is binomial, we must also supply <code>trials_var</code>, which is the name of the column in <code>data</code> which contains the number of trials in the binomial call.</p>
<p><code>bnec</code> will guess the data types for use, although we could manually specify <code>y_type</code> as “binomial” and <code>x_type</code> as “gamma”. This example fits without specifying either, but <code>trials_var</code> must be supplied.</p>
<div class="sourceCode" id="cb8"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://open-aims.github.io/bayesnec">bayesnec</a></span>)

<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">333</span>)
<span class="kw">exp_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bnec.html">bnec</a></span>(data = <span class="kw">binom_data</span>, x_var = <span class="st">"log_x"</span>,
              y_var = <span class="st">"suc"</span>, model = <span class="st">"nec3param"</span>,
              trials_var = <span class="st">"tot"</span>)
</pre></div>
<pre><code>## 
## SAMPLING FOR MODEL '1113ecee5d95d3d0743ff2f16b24181b' NOW (CHAIN 1).
## Chain 1: 
## Chain 1: Gradient evaluation took 8.2e-05 seconds
## Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 0.82 seconds.
## Chain 1: Adjust your expectations accordingly!
## Chain 1: 
## Chain 1: 
## Chain 1: Iteration:     1 / 20000 [  0%]  (Warmup)
## Chain 1: Iteration:  2000 / 20000 [ 10%]  (Warmup)
## Chain 1: Iteration:  4000 / 20000 [ 20%]  (Warmup)
## Chain 1: Iteration:  6000 / 20000 [ 30%]  (Warmup)
## Chain 1: Iteration:  8000 / 20000 [ 40%]  (Warmup)
## Chain 1: Iteration: 10000 / 20000 [ 50%]  (Warmup)
## Chain 1: Iteration: 12000 / 20000 [ 60%]  (Warmup)
## Chain 1: Iteration: 14000 / 20000 [ 70%]  (Warmup)
## Chain 1: Iteration: 16000 / 20000 [ 80%]  (Warmup)
## Chain 1: Iteration: 16001 / 20000 [ 80%]  (Sampling)
## Chain 1: Iteration: 18000 / 20000 [ 90%]  (Sampling)
## Chain 1: Iteration: 20000 / 20000 [100%]  (Sampling)
## Chain 1: 
## Chain 1:  Elapsed Time: 2.27184 seconds (Warm-up)
## Chain 1:                0.665709 seconds (Sampling)
## Chain 1:                2.93755 seconds (Total)
## Chain 1: 
## 
## SAMPLING FOR MODEL '1113ecee5d95d3d0743ff2f16b24181b' NOW (CHAIN 2).
## Chain 2: 
## Chain 2: Gradient evaluation took 2.9e-05 seconds
## Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 0.29 seconds.
## Chain 2: Adjust your expectations accordingly!
## Chain 2: 
## Chain 2: 
## Chain 2: Iteration:     1 / 20000 [  0%]  (Warmup)
## Chain 2: Iteration:  2000 / 20000 [ 10%]  (Warmup)
## Chain 2: Iteration:  4000 / 20000 [ 20%]  (Warmup)
## Chain 2: Iteration:  6000 / 20000 [ 30%]  (Warmup)
## Chain 2: Iteration:  8000 / 20000 [ 40%]  (Warmup)
## Chain 2: Iteration: 10000 / 20000 [ 50%]  (Warmup)
## Chain 2: Iteration: 12000 / 20000 [ 60%]  (Warmup)
## Chain 2: Iteration: 14000 / 20000 [ 70%]  (Warmup)
## Chain 2: Iteration: 16000 / 20000 [ 80%]  (Warmup)
## Chain 2: Iteration: 16001 / 20000 [ 80%]  (Sampling)
## Chain 2: Iteration: 18000 / 20000 [ 90%]  (Sampling)
## Chain 2: Iteration: 20000 / 20000 [100%]  (Sampling)
## Chain 2: 
## Chain 2:  Elapsed Time: 2.25712 seconds (Warm-up)
## Chain 2:                0.734333 seconds (Sampling)
## Chain 2:                2.99145 seconds (Total)
## Chain 2: 
## 
## SAMPLING FOR MODEL '1113ecee5d95d3d0743ff2f16b24181b' NOW (CHAIN 3).
## Chain 3: 
## Chain 3: Gradient evaluation took 2.9e-05 seconds
## Chain 3: 1000 transitions using 10 leapfrog steps per transition would take 0.29 seconds.
## Chain 3: Adjust your expectations accordingly!
## Chain 3: 
## Chain 3: 
## Chain 3: Iteration:     1 / 20000 [  0%]  (Warmup)
## Chain 3: Iteration:  2000 / 20000 [ 10%]  (Warmup)
## Chain 3: Iteration:  4000 / 20000 [ 20%]  (Warmup)
## Chain 3: Iteration:  6000 / 20000 [ 30%]  (Warmup)
## Chain 3: Iteration:  8000 / 20000 [ 40%]  (Warmup)
## Chain 3: Iteration: 10000 / 20000 [ 50%]  (Warmup)
## Chain 3: Iteration: 12000 / 20000 [ 60%]  (Warmup)
## Chain 3: Iteration: 14000 / 20000 [ 70%]  (Warmup)
## Chain 3: Iteration: 16000 / 20000 [ 80%]  (Warmup)
## Chain 3: Iteration: 16001 / 20000 [ 80%]  (Sampling)
## Chain 3: Iteration: 18000 / 20000 [ 90%]  (Sampling)
## Chain 3: Iteration: 20000 / 20000 [100%]  (Sampling)
## Chain 3: 
## Chain 3:  Elapsed Time: 2.23221 seconds (Warm-up)
## Chain 3:                0.719499 seconds (Sampling)
## Chain 3:                2.95171 seconds (Total)
## Chain 3: 
## 
## SAMPLING FOR MODEL '1113ecee5d95d3d0743ff2f16b24181b' NOW (CHAIN 4).
## Chain 4: 
## Chain 4: Gradient evaluation took 3.1e-05 seconds
## Chain 4: 1000 transitions using 10 leapfrog steps per transition would take 0.31 seconds.
## Chain 4: Adjust your expectations accordingly!
## Chain 4: 
## Chain 4: 
## Chain 4: Iteration:     1 / 20000 [  0%]  (Warmup)
## Chain 4: Iteration:  2000 / 20000 [ 10%]  (Warmup)
## Chain 4: Iteration:  4000 / 20000 [ 20%]  (Warmup)
## Chain 4: Iteration:  6000 / 20000 [ 30%]  (Warmup)
## Chain 4: Iteration:  8000 / 20000 [ 40%]  (Warmup)
## Chain 4: Iteration: 10000 / 20000 [ 50%]  (Warmup)
## Chain 4: Iteration: 12000 / 20000 [ 60%]  (Warmup)
## Chain 4: Iteration: 14000 / 20000 [ 70%]  (Warmup)
## Chain 4: Iteration: 16000 / 20000 [ 80%]  (Warmup)
## Chain 4: Iteration: 16001 / 20000 [ 80%]  (Sampling)
## Chain 4: Iteration: 18000 / 20000 [ 90%]  (Sampling)
## Chain 4: Iteration: 20000 / 20000 [100%]  (Sampling)
## Chain 4: 
## Chain 4:  Elapsed Time: 2.33612 seconds (Warm-up)
## Chain 4:                0.76974 seconds (Sampling)
## Chain 4:                3.10586 seconds (Total)
## Chain 4:</code></pre>
<p>The function shows the progress of the <code>brms</code> fit and returns the usual <code>brms</code> output (with a few other elements added to this list). The function <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot(exp_1$fit)</a></code> can be used to plot the chains, so we can assess mixing and look for other potential issues with the model fit. Initially <code>bayesnec</code> will attempt to use starting values generated for that type of model formula and family. It will run the iterations and then test if all chains are valid. If the model does not have valid chains <code>bayesnec</code> with try up to <code>n_tries</code> more times to fit the data using the generated initial values and obtain a successfully fitted model with good mixing. If no model is successfully fit an error will be returned indicating the model could not be fit successfully.</p>
<div class="sourceCode" id="cb10"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span>(<span class="kw">exp_1</span><span class="op">$</span><span class="kw">fit</span>)
</pre></div>
<p><img src="example_files/figure-html/unnamed-chunk-7-1.png" width="672"></p>
<p>In our example, the chains are well mixed and the probability density plots look good. We can also do a pairs plot that can help to assess issues with identifiability, which also looks ok. There are a range of other model diagnostics that can be explored for brms model fits, using the $fit syntax. We encourage you to explore the rich material already on github regarding use and validation of [brms] (<a href="https://github.com/paul-buerkner/brms" class="uri">https://github.com/paul-buerkner/brms</a>) models.</p>
<div class="sourceCode" id="cb11"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/graphics/pairs.html">pairs</a></span>(<span class="kw">exp_1</span><span class="op">$</span><span class="kw">fit</span>)
</pre></div>
<p><img src="example_files/figure-html/unnamed-chunk-8-1.png" width="672"></p>
<p>We can see the summary of our fitted model parameters using:</p>
<div class="sourceCode" id="cb12"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="kw">exp_1</span><span class="op">$</span><span class="kw">fit</span>)
</pre></div>
<pre><code>##  Family: binomial 
##   Links: mu = identity 
## Formula: y | trials(trials) ~ top * exp(-beta * (x - nec) * step(x - nec)) 
##          top ~ 1
##          beta ~ 1
##          nec ~ 1
##    Data: structure(list(x = c(-2.30258509299405, -2.3025850 (Number of observations: 48) 
## Samples: 4 chains, each with iter = 20000; warmup = 16000; thin = 1;
##          total post-warmup samples = 16000
## 
## Population-Level Effects: 
##                Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## top_Intercept      0.83      0.01     0.81     0.84 1.00    10078     9569
## beta_Intercept     1.61      0.08     1.44     1.77 1.00     7465     8474
## nec_Intercept      4.36      0.03     4.30     4.42 1.00     7422     7411
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Note the Rhat values in this example are one, indicating convergence.</p>
<p>The function <code>plot</code> can be used to plot the fitted model. You can also make your own plot from the data included in the returned <code>bayesnecfit</code> object from the call to <code>bnec</code>. Here we use the default plot method from <code>bayesnec</code>, where we add the exp function to plot the tick labels on the original scaling of the concentration data.</p>
<div class="sourceCode" id="cb14"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span>(<span class="kw">exp_1</span>, lxform=<span class="kw">exp</span>)
</pre></div>
<p><img src="example_files/figure-html/unnamed-chunk-10-1.png" width="672"></p>
<p>Alternatively, we can use the built in <code>brms</code> methods to plot the <code>brms</code> fit directly. For example:</p>
<div class="sourceCode" id="cb15"><pre class="downlit">
<span class="kw">df</span> <span class="op">&lt;-</span> <span class="kw">exp_1</span><span class="op">$</span><span class="kw">fit</span><span class="op">$</span><span class="kw">data</span> <span class="op">%&gt;%</span>
  <span class="kw">dplyr</span>::<span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(prop = <span class="kw">y</span> <span class="op">/</span> <span class="kw">trials</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span>(<span class="kw">brms</span>::<span class="fu"><a href="https://rdrr.io/pkg/brms/man/conditional_effects.brmsfit.html">conditional_effects</a></span>(<span class="kw">exp_1</span><span class="op">$</span><span class="kw">fit</span>))[[<span class="fl">1</span>]] <span class="op">+</span>
     <span class="fu">geom_point</span>(data = <span class="kw">df</span>, <span class="fu">aes</span>(x = <span class="kw">x</span>, y = <span class="kw">prop</span>),
                inherit.aes = <span class="fl">FALSE</span>)
</pre></div>
<p><img src="example_files/figure-html/unnamed-chunk-11-1.png" width="672"><img src="example_files/figure-html/unnamed-chunk-11-2.png" width="672"></p>
<p>This model fit doesn’t look great. You can see that the error bounds around the fit are far too narrow for this data, suggesting over dispersion of this model (meaning that the data are more variable than this model fit predicts). An estimate of dispersion is provided by <code>bayesnec</code>, and this can be extracted using <code>exp_5$dispersion</code>. Values &gt;1 indicate over-dispersion and values &lt;1 indicate under-dispersion. In this case the over-dispersion value is much bigger than 1, suggesting extreme over-dispersion (meaning our model doesn’t properly capture the true variability represented in this data). We would need consider alternative ways of modelling this data using a different distribution. One option would be to try modelling the proportions as a Beta, for example - although this looses the information in how many trials underpin each data point, which in this case may not be valid as they vary substantially for each row.</p>
<div class="sourceCode" id="cb16"><pre class="downlit">
<span class="kw">exp_1</span><span class="op">$</span><span class="kw">dispersion</span>
</pre></div>
<pre><code>## Estimate     Q2.5    Q97.5 
## 21.35818 14.05482 33.54521</code></pre>
</div>
<div id="beta-data" class="section level3">
<h3 class="hasAnchor">
<a href="#beta-data" class="anchor"></a>Beta data</h3>
<p>Sometimes the response variable is distributed between <code>0</code> and <code>1</code> but is not a straight forward binomial. A common example in coral ecology is maximum quantum yield (the proportion of light used for photosynthesis when all reaction centres are open) which is a measure of photosynthetic efficiency calculated from PAM data. Here we have a proportion value that is not based on trials and successes. In this case there are no theoretical ‘trials’ and the data must be modelled using a beta distribution.</p>
<div class="sourceCode" id="cb18"><pre class="downlit">
<span class="kw">prop_data</span> <span class="op">&lt;-</span> <span class="st">"https://pastebin.com/raw/123jq46d"</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span>(header = <span class="fl">TRUE</span>, dec = <span class="st">","</span>, stringsAsFactors = <span class="fl">FALSE</span>) <span class="op">%&gt;%</span>
  <span class="kw">dplyr</span>::<span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span>(raw_x = <span class="kw">raw.x</span>) <span class="op">%&gt;%</span>
  <span class="kw">dplyr</span>::<span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(raw_x = <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="kw">raw_x</span>)) <span class="op">+</span> <span class="fl">1</span>),
                resp = <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="kw">resp</span>)))

<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">333</span>)
<span class="kw">exp_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bnec.html">bnec</a></span>(data = <span class="kw">prop_data</span>, x_var = <span class="st">"raw_x"</span>,
              y_var = <span class="st">"resp"</span>, model = <span class="st">"nec3param"</span>)
</pre></div>
<pre><code>## 
## SAMPLING FOR MODEL '6903135230a6b818174962a7b50f698a' NOW (CHAIN 1).
## Chain 1: 
## Chain 1: Gradient evaluation took 0.000136 seconds
## Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 1.36 seconds.
## Chain 1: Adjust your expectations accordingly!
## Chain 1: 
## Chain 1: 
## Chain 1: Iteration:     1 / 20000 [  0%]  (Warmup)
## Chain 1: Iteration:  2000 / 20000 [ 10%]  (Warmup)
## Chain 1: Iteration:  4000 / 20000 [ 20%]  (Warmup)
## Chain 1: Iteration:  6000 / 20000 [ 30%]  (Warmup)
## Chain 1: Iteration:  8000 / 20000 [ 40%]  (Warmup)
## Chain 1: Iteration: 10000 / 20000 [ 50%]  (Warmup)
## Chain 1: Iteration: 12000 / 20000 [ 60%]  (Warmup)
## Chain 1: Iteration: 14000 / 20000 [ 70%]  (Warmup)
## Chain 1: Iteration: 16000 / 20000 [ 80%]  (Warmup)
## Chain 1: Iteration: 16001 / 20000 [ 80%]  (Sampling)
## Chain 1: Iteration: 18000 / 20000 [ 90%]  (Sampling)
## Chain 1: Iteration: 20000 / 20000 [100%]  (Sampling)
## Chain 1: 
## Chain 1:  Elapsed Time: 13.2734 seconds (Warm-up)
## Chain 1:                4.55001 seconds (Sampling)
## Chain 1:                17.8234 seconds (Total)
## Chain 1: 
## 
## SAMPLING FOR MODEL '6903135230a6b818174962a7b50f698a' NOW (CHAIN 2).
## Chain 2: 
## Chain 2: Gradient evaluation took 7.9e-05 seconds
## Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 0.79 seconds.
## Chain 2: Adjust your expectations accordingly!
## Chain 2: 
## Chain 2: 
## Chain 2: Iteration:     1 / 20000 [  0%]  (Warmup)
## Chain 2: Iteration:  2000 / 20000 [ 10%]  (Warmup)
## Chain 2: Iteration:  4000 / 20000 [ 20%]  (Warmup)
## Chain 2: Iteration:  6000 / 20000 [ 30%]  (Warmup)
## Chain 2: Iteration:  8000 / 20000 [ 40%]  (Warmup)
## Chain 2: Iteration: 10000 / 20000 [ 50%]  (Warmup)
## Chain 2: Iteration: 12000 / 20000 [ 60%]  (Warmup)
## Chain 2: Iteration: 14000 / 20000 [ 70%]  (Warmup)
## Chain 2: Iteration: 16000 / 20000 [ 80%]  (Warmup)
## Chain 2: Iteration: 16001 / 20000 [ 80%]  (Sampling)
## Chain 2: Iteration: 18000 / 20000 [ 90%]  (Sampling)
## Chain 2: Iteration: 20000 / 20000 [100%]  (Sampling)
## Chain 2: 
## Chain 2:  Elapsed Time: 12.9055 seconds (Warm-up)
## Chain 2:                4.52892 seconds (Sampling)
## Chain 2:                17.4344 seconds (Total)
## Chain 2: 
## 
## SAMPLING FOR MODEL '6903135230a6b818174962a7b50f698a' NOW (CHAIN 3).
## Chain 3: 
## Chain 3: Gradient evaluation took 7.3e-05 seconds
## Chain 3: 1000 transitions using 10 leapfrog steps per transition would take 0.73 seconds.
## Chain 3: Adjust your expectations accordingly!
## Chain 3: 
## Chain 3: 
## Chain 3: Iteration:     1 / 20000 [  0%]  (Warmup)
## Chain 3: Iteration:  2000 / 20000 [ 10%]  (Warmup)
## Chain 3: Iteration:  4000 / 20000 [ 20%]  (Warmup)
## Chain 3: Iteration:  6000 / 20000 [ 30%]  (Warmup)
## Chain 3: Iteration:  8000 / 20000 [ 40%]  (Warmup)
## Chain 3: Iteration: 10000 / 20000 [ 50%]  (Warmup)
## Chain 3: Iteration: 12000 / 20000 [ 60%]  (Warmup)
## Chain 3: Iteration: 14000 / 20000 [ 70%]  (Warmup)
## Chain 3: Iteration: 16000 / 20000 [ 80%]  (Warmup)
## Chain 3: Iteration: 16001 / 20000 [ 80%]  (Sampling)
## Chain 3: Iteration: 18000 / 20000 [ 90%]  (Sampling)
## Chain 3: Iteration: 20000 / 20000 [100%]  (Sampling)
## Chain 3: 
## Chain 3:  Elapsed Time: 12.9373 seconds (Warm-up)
## Chain 3:                4.22311 seconds (Sampling)
## Chain 3:                17.1604 seconds (Total)
## Chain 3: 
## 
## SAMPLING FOR MODEL '6903135230a6b818174962a7b50f698a' NOW (CHAIN 4).
## Chain 4: 
## Chain 4: Gradient evaluation took 7.8e-05 seconds
## Chain 4: 1000 transitions using 10 leapfrog steps per transition would take 0.78 seconds.
## Chain 4: Adjust your expectations accordingly!
## Chain 4: 
## Chain 4: 
## Chain 4: Iteration:     1 / 20000 [  0%]  (Warmup)
## Chain 4: Iteration:  2000 / 20000 [ 10%]  (Warmup)
## Chain 4: Iteration:  4000 / 20000 [ 20%]  (Warmup)
## Chain 4: Iteration:  6000 / 20000 [ 30%]  (Warmup)
## Chain 4: Iteration:  8000 / 20000 [ 40%]  (Warmup)
## Chain 4: Iteration: 10000 / 20000 [ 50%]  (Warmup)
## Chain 4: Iteration: 12000 / 20000 [ 60%]  (Warmup)
## Chain 4: Iteration: 14000 / 20000 [ 70%]  (Warmup)
## Chain 4: Iteration: 16000 / 20000 [ 80%]  (Warmup)
## Chain 4: Iteration: 16001 / 20000 [ 80%]  (Sampling)
## Chain 4: Iteration: 18000 / 20000 [ 90%]  (Sampling)
## Chain 4: Iteration: 20000 / 20000 [100%]  (Sampling)
## Chain 4: 
## Chain 4:  Elapsed Time: 12.7932 seconds (Warm-up)
## Chain 4:                4.26806 seconds (Sampling)
## Chain 4:                17.0613 seconds (Total)
## Chain 4:</code></pre>
<div class="sourceCode" id="cb20"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span>(<span class="kw">exp_2</span><span class="op">$</span><span class="kw">fit</span>)
</pre></div>
<p><img src="example_files/figure-html/unnamed-chunk-13-1.png" width="672"></p>
<div class="sourceCode" id="cb21"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span>(<span class="kw">exp_2</span>)
</pre></div>
<p><img src="example_files/figure-html/unnamed-chunk-14-1.png" width="672"></p>
</div>
<div id="poisson-data" class="section level3">
<h3 class="hasAnchor">
<a href="#poisson-data" class="anchor"></a>Poisson data</h3>
<p>Where data are a count (of, for example, individuals or cells) y is poisson. Such data are distributed from <code>0</code> to <code>Inf</code> and are integers. First we read in the count data example from <a href="https://pastebin.com/tools">pastebin</a>, and then plot the “concentration” or x data, Again, this is <code>raw_x</code>, and distributed as in our binomial example above.</p>
<div class="sourceCode" id="cb22"><pre class="downlit">
<span class="kw">count_data</span> <span class="op">&lt;-</span> <span class="st">"https://pastebin.com/raw/ENgNSgf7"</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span>(header = <span class="fl">TRUE</span>, dec = <span class="st">","</span>, stringsAsFactors = <span class="fl">FALSE</span>) <span class="op">%&gt;%</span>
  <span class="kw">dplyr</span>::<span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span>(raw_x = <span class="kw">raw.x</span>) <span class="op">%&gt;%</span>
  <span class="kw">dplyr</span>::<span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(raw_x = <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="kw">raw_x</span>)))

<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="kw">count_data</span>)
</pre></div>
<pre><code>## 'data.frame':    48 obs. of  2 variables:
##  $ raw_x: num  0.1 0.1 0.1 0.1 0.1 0.1 9.67 9.67 9.67 9.67 ...
##  $ count: int  164 100 103 102 102 101 131 102 112 100 ...</code></pre>
<div class="sourceCode" id="cb24"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span>(<span class="kw">count_data</span><span class="op">$</span><span class="kw">raw_x</span>)
</pre></div>
<pre><code>## [1]   0.1 190.0</code></pre>
<div class="sourceCode" id="cb26"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(mfrow = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">2</span>))
<span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span>(<span class="kw">count_data</span><span class="op">$</span><span class="kw">raw_x</span>, xlab = <span class="st">"'x' variable"</span>, main = <span class="st">""</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span>(<span class="kw">count_data</span><span class="op">$</span><span class="kw">count</span>, xlab = <span class="st">"Total counts"</span>, main = <span class="st">""</span>)
</pre></div>
<p><img src="example_files/figure-html/unnamed-chunk-15-1.png" width="960"></p>
<p>First we supply <code>bnec</code> with <code>data</code> (count_data), and specify <code>x_var</code> and <code>y_var</code>. As we have concentration data, our <code>x_type</code> would be the gamma distribution, and <code>y_type</code> is “poisson”. The default behaviour to guess the variable types works for this example.</p>
<div class="sourceCode" id="cb27"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">333</span>)
<span class="kw">exp_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bnec.html">bnec</a></span>(data = <span class="kw">count_data</span>, x_var = <span class="st">"raw_x"</span>,
              y_var = <span class="st">"count"</span>, model = <span class="st">"nec3param"</span>)
</pre></div>
<pre><code>## 
## SAMPLING FOR MODEL '7b7ca65d04c0d0109b32f593e92cb5df' NOW (CHAIN 1).
## Chain 1: 
## Chain 1: Gradient evaluation took 5.2e-05 seconds
## Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 0.52 seconds.
## Chain 1: Adjust your expectations accordingly!
## Chain 1: 
## Chain 1: 
## Chain 1: Iteration:     1 / 20000 [  0%]  (Warmup)
## Chain 1: Iteration:  2000 / 20000 [ 10%]  (Warmup)
## Chain 1: Iteration:  4000 / 20000 [ 20%]  (Warmup)
## Chain 1: Iteration:  6000 / 20000 [ 30%]  (Warmup)
## Chain 1: Iteration:  8000 / 20000 [ 40%]  (Warmup)
## Chain 1: Iteration: 10000 / 20000 [ 50%]  (Warmup)
## Chain 1: Iteration: 12000 / 20000 [ 60%]  (Warmup)
## Chain 1: Iteration: 14000 / 20000 [ 70%]  (Warmup)
## Chain 1: Iteration: 16000 / 20000 [ 80%]  (Warmup)
## Chain 1: Iteration: 16001 / 20000 [ 80%]  (Sampling)
## Chain 1: Iteration: 18000 / 20000 [ 90%]  (Sampling)
## Chain 1: Iteration: 20000 / 20000 [100%]  (Sampling)
## Chain 1: 
## Chain 1:  Elapsed Time: 2.58442 seconds (Warm-up)
## Chain 1:                0.453175 seconds (Sampling)
## Chain 1:                3.0376 seconds (Total)
## Chain 1: 
## 
## SAMPLING FOR MODEL '7b7ca65d04c0d0109b32f593e92cb5df' NOW (CHAIN 2).
## Chain 2: 
## Chain 2: Gradient evaluation took 2.3e-05 seconds
## Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 0.23 seconds.
## Chain 2: Adjust your expectations accordingly!
## Chain 2: 
## Chain 2: 
## Chain 2: Iteration:     1 / 20000 [  0%]  (Warmup)
## Chain 2: Iteration:  2000 / 20000 [ 10%]  (Warmup)
## Chain 2: Iteration:  4000 / 20000 [ 20%]  (Warmup)
## Chain 2: Iteration:  6000 / 20000 [ 30%]  (Warmup)
## Chain 2: Iteration:  8000 / 20000 [ 40%]  (Warmup)
## Chain 2: Iteration: 10000 / 20000 [ 50%]  (Warmup)
## Chain 2: Iteration: 12000 / 20000 [ 60%]  (Warmup)
## Chain 2: Iteration: 14000 / 20000 [ 70%]  (Warmup)
## Chain 2: Iteration: 16000 / 20000 [ 80%]  (Warmup)
## Chain 2: Iteration: 16001 / 20000 [ 80%]  (Sampling)
## Chain 2: Iteration: 18000 / 20000 [ 90%]  (Sampling)
## Chain 2: Iteration: 20000 / 20000 [100%]  (Sampling)
## Chain 2: 
## Chain 2:  Elapsed Time: 2.35838 seconds (Warm-up)
## Chain 2:                0.445249 seconds (Sampling)
## Chain 2:                2.80363 seconds (Total)
## Chain 2: 
## 
## SAMPLING FOR MODEL '7b7ca65d04c0d0109b32f593e92cb5df' NOW (CHAIN 3).
## Chain 3: 
## Chain 3: Gradient evaluation took 2.3e-05 seconds
## Chain 3: 1000 transitions using 10 leapfrog steps per transition would take 0.23 seconds.
## Chain 3: Adjust your expectations accordingly!
## Chain 3: 
## Chain 3: 
## Chain 3: Iteration:     1 / 20000 [  0%]  (Warmup)
## Chain 3: Iteration:  2000 / 20000 [ 10%]  (Warmup)
## Chain 3: Iteration:  4000 / 20000 [ 20%]  (Warmup)
## Chain 3: Iteration:  6000 / 20000 [ 30%]  (Warmup)
## Chain 3: Iteration:  8000 / 20000 [ 40%]  (Warmup)
## Chain 3: Iteration: 10000 / 20000 [ 50%]  (Warmup)
## Chain 3: Iteration: 12000 / 20000 [ 60%]  (Warmup)
## Chain 3: Iteration: 14000 / 20000 [ 70%]  (Warmup)
## Chain 3: Iteration: 16000 / 20000 [ 80%]  (Warmup)
## Chain 3: Iteration: 16001 / 20000 [ 80%]  (Sampling)
## Chain 3: Iteration: 18000 / 20000 [ 90%]  (Sampling)
## Chain 3: Iteration: 20000 / 20000 [100%]  (Sampling)
## Chain 3: 
## Chain 3:  Elapsed Time: 2.91128 seconds (Warm-up)
## Chain 3:                0.612262 seconds (Sampling)
## Chain 3:                3.52354 seconds (Total)
## Chain 3: 
## 
## SAMPLING FOR MODEL '7b7ca65d04c0d0109b32f593e92cb5df' NOW (CHAIN 4).
## Chain 4: 
## Chain 4: Gradient evaluation took 2.3e-05 seconds
## Chain 4: 1000 transitions using 10 leapfrog steps per transition would take 0.23 seconds.
## Chain 4: Adjust your expectations accordingly!
## Chain 4: 
## Chain 4: 
## Chain 4: Iteration:     1 / 20000 [  0%]  (Warmup)
## Chain 4: Iteration:  2000 / 20000 [ 10%]  (Warmup)
## Chain 4: Iteration:  4000 / 20000 [ 20%]  (Warmup)
## Chain 4: Iteration:  6000 / 20000 [ 30%]  (Warmup)
## Chain 4: Iteration:  8000 / 20000 [ 40%]  (Warmup)
## Chain 4: Iteration: 10000 / 20000 [ 50%]  (Warmup)
## Chain 4: Iteration: 12000 / 20000 [ 60%]  (Warmup)
## Chain 4: Iteration: 14000 / 20000 [ 70%]  (Warmup)
## Chain 4: Iteration: 16000 / 20000 [ 80%]  (Warmup)
## Chain 4: Iteration: 16001 / 20000 [ 80%]  (Sampling)
## Chain 4: Iteration: 18000 / 20000 [ 90%]  (Sampling)
## Chain 4: Iteration: 20000 / 20000 [100%]  (Sampling)
## Chain 4: 
## Chain 4:  Elapsed Time: 2.23555 seconds (Warm-up)
## Chain 4:                0.458743 seconds (Sampling)
## Chain 4:                2.69429 seconds (Total)
## Chain 4:</code></pre>
<p>We first plot the model chains and parameter estimates to check the fit.</p>
<div class="sourceCode" id="cb29"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span>(<span class="kw">exp_3</span><span class="op">$</span><span class="kw">fit</span>)
</pre></div>
<p><img src="example_files/figure-html/unnamed-chunk-17-1.png" width="672"></p>
<div class="sourceCode" id="cb30"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span>(<span class="kw">exp_3</span>)
</pre></div>
<p><img src="example_files/figure-html/unnamed-chunk-18-1.png" width="672"></p>
</div>
<div id="measure-data" class="section level3">
<h3 class="hasAnchor">
<a href="#measure-data" class="anchor"></a>Measure data</h3>
<p>Where data are a measured variable (i.e. length or size) y is gamma. Such data are distributed from <code>0+</code> to <code>Inf</code> and are continuous. First we read in the count data example from pastebin, and then plot the “concentration” or x data, Again, this is raw_x, and distributed as in our binomial example above.</p>
<div class="sourceCode" id="cb31"><pre class="downlit">
<span class="kw">measure_data</span> <span class="op">&lt;-</span> <span class="st">"https://pastebin.com/raw/pWeS6x0n"</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span>(header = <span class="fl">TRUE</span>, dec = <span class="st">","</span>, stringsAsFactors = <span class="fl">FALSE</span>) <span class="op">%&gt;%</span>
  <span class="kw">dplyr</span>::<span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span>(raw_x = <span class="kw">raw.x</span>) <span class="op">%&gt;%</span>
  <span class="kw">dplyr</span>::<span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">dplyr</span>::<span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span>(<span class="fu">where</span>(<span class="kw">is.character</span>), <span class="kw">as.numeric</span>))
</pre></div>
<div class="sourceCode" id="cb32"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">333</span>)
<span class="kw">exp_4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bnec.html">bnec</a></span>(data = <span class="kw">measure_data</span>, x_var = <span class="st">"raw_x"</span>,
              y_var = <span class="st">"measure"</span>, model = <span class="st">"nec3param"</span>)
</pre></div>
<pre><code>## 
## SAMPLING FOR MODEL '40348b7736a50da6007b8cf0b24d35a4' NOW (CHAIN 1).
## Chain 1: 
## Chain 1: Gradient evaluation took 6.9e-05 seconds
## Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 0.69 seconds.
## Chain 1: Adjust your expectations accordingly!
## Chain 1: 
## Chain 1: 
## Chain 1: Iteration:     1 / 20000 [  0%]  (Warmup)
## Chain 1: Iteration:  2000 / 20000 [ 10%]  (Warmup)
## Chain 1: Iteration:  4000 / 20000 [ 20%]  (Warmup)
## Chain 1: Iteration:  6000 / 20000 [ 30%]  (Warmup)
## Chain 1: Iteration:  8000 / 20000 [ 40%]  (Warmup)
## Chain 1: Iteration: 10000 / 20000 [ 50%]  (Warmup)
## Chain 1: Iteration: 12000 / 20000 [ 60%]  (Warmup)
## Chain 1: Iteration: 14000 / 20000 [ 70%]  (Warmup)
## Chain 1: Iteration: 16000 / 20000 [ 80%]  (Warmup)
## Chain 1: Iteration: 16001 / 20000 [ 80%]  (Sampling)
## Chain 1: Iteration: 18000 / 20000 [ 90%]  (Sampling)
## Chain 1: Iteration: 20000 / 20000 [100%]  (Sampling)
## Chain 1: 
## Chain 1:  Elapsed Time: 3.88027 seconds (Warm-up)
## Chain 1:                0.908608 seconds (Sampling)
## Chain 1:                4.78888 seconds (Total)
## Chain 1: 
## 
## SAMPLING FOR MODEL '40348b7736a50da6007b8cf0b24d35a4' NOW (CHAIN 2).
## Chain 2: 
## Chain 2: Gradient evaluation took 2.5e-05 seconds
## Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 0.25 seconds.
## Chain 2: Adjust your expectations accordingly!
## Chain 2: 
## Chain 2: 
## Chain 2: Iteration:     1 / 20000 [  0%]  (Warmup)
## Chain 2: Iteration:  2000 / 20000 [ 10%]  (Warmup)
## Chain 2: Iteration:  4000 / 20000 [ 20%]  (Warmup)
## Chain 2: Iteration:  6000 / 20000 [ 30%]  (Warmup)
## Chain 2: Iteration:  8000 / 20000 [ 40%]  (Warmup)
## Chain 2: Iteration: 10000 / 20000 [ 50%]  (Warmup)
## Chain 2: Iteration: 12000 / 20000 [ 60%]  (Warmup)
## Chain 2: Iteration: 14000 / 20000 [ 70%]  (Warmup)
## Chain 2: Iteration: 16000 / 20000 [ 80%]  (Warmup)
## Chain 2: Iteration: 16001 / 20000 [ 80%]  (Sampling)
## Chain 2: Iteration: 18000 / 20000 [ 90%]  (Sampling)
## Chain 2: Iteration: 20000 / 20000 [100%]  (Sampling)
## Chain 2: 
## Chain 2:  Elapsed Time: 3.96972 seconds (Warm-up)
## Chain 2:                0.959223 seconds (Sampling)
## Chain 2:                4.92894 seconds (Total)
## Chain 2: 
## 
## SAMPLING FOR MODEL '40348b7736a50da6007b8cf0b24d35a4' NOW (CHAIN 3).
## Chain 3: 
## Chain 3: Gradient evaluation took 2.4e-05 seconds
## Chain 3: 1000 transitions using 10 leapfrog steps per transition would take 0.24 seconds.
## Chain 3: Adjust your expectations accordingly!
## Chain 3: 
## Chain 3: 
## Chain 3: Iteration:     1 / 20000 [  0%]  (Warmup)
## Chain 3: Iteration:  2000 / 20000 [ 10%]  (Warmup)
## Chain 3: Iteration:  4000 / 20000 [ 20%]  (Warmup)
## Chain 3: Iteration:  6000 / 20000 [ 30%]  (Warmup)
## Chain 3: Iteration:  8000 / 20000 [ 40%]  (Warmup)
## Chain 3: Iteration: 10000 / 20000 [ 50%]  (Warmup)
## Chain 3: Iteration: 12000 / 20000 [ 60%]  (Warmup)
## Chain 3: Iteration: 14000 / 20000 [ 70%]  (Warmup)
## Chain 3: Iteration: 16000 / 20000 [ 80%]  (Warmup)
## Chain 3: Iteration: 16001 / 20000 [ 80%]  (Sampling)
## Chain 3: Iteration: 18000 / 20000 [ 90%]  (Sampling)
## Chain 3: Iteration: 20000 / 20000 [100%]  (Sampling)
## Chain 3: 
## Chain 3:  Elapsed Time: 4.19717 seconds (Warm-up)
## Chain 3:                0.846534 seconds (Sampling)
## Chain 3:                5.04371 seconds (Total)
## Chain 3: 
## 
## SAMPLING FOR MODEL '40348b7736a50da6007b8cf0b24d35a4' NOW (CHAIN 4).
## Chain 4: 
## Chain 4: Gradient evaluation took 2.5e-05 seconds
## Chain 4: 1000 transitions using 10 leapfrog steps per transition would take 0.25 seconds.
## Chain 4: Adjust your expectations accordingly!
## Chain 4: 
## Chain 4: 
## Chain 4: Iteration:     1 / 20000 [  0%]  (Warmup)
## Chain 4: Iteration:  2000 / 20000 [ 10%]  (Warmup)
## Chain 4: Iteration:  4000 / 20000 [ 20%]  (Warmup)
## Chain 4: Iteration:  6000 / 20000 [ 30%]  (Warmup)
## Chain 4: Iteration:  8000 / 20000 [ 40%]  (Warmup)
## Chain 4: Iteration: 10000 / 20000 [ 50%]  (Warmup)
## Chain 4: Iteration: 12000 / 20000 [ 60%]  (Warmup)
## Chain 4: Iteration: 14000 / 20000 [ 70%]  (Warmup)
## Chain 4: Iteration: 16000 / 20000 [ 80%]  (Warmup)
## Chain 4: Iteration: 16001 / 20000 [ 80%]  (Sampling)
## Chain 4: Iteration: 18000 / 20000 [ 90%]  (Sampling)
## Chain 4: Iteration: 20000 / 20000 [100%]  (Sampling)
## Chain 4: 
## Chain 4:  Elapsed Time: 3.97025 seconds (Warm-up)
## Chain 4:                0.901391 seconds (Sampling)
## Chain 4:                4.87164 seconds (Total)
## Chain 4:</code></pre>
<div class="sourceCode" id="cb34"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span>(<span class="kw">exp_4</span><span class="op">$</span><span class="kw">fit</span>)
</pre></div>
<p><img src="example_files/figure-html/unnamed-chunk-21-1.png" width="672"></p>
<p>The function <code>plot</code> can be used to plot the fitted model. The estimated <em>NEC</em> value can be obtained directly from the fitted model object, using <code>exp_4$nec</code>.</p>
<div class="sourceCode" id="cb35"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span>(<span class="kw">exp_4</span>)
</pre></div>
<p><img src="example_files/figure-html/unnamed-chunk-22-1.png" width="672"></p>
<p>EC<em>x</em> estimates can also be obtained from the <em>NEC</em> model fit, using the function <code>ecx</code>. Note these may differ from a typical 4-parameter non-linear model, as the <em>NEC</em> model is a broken stick non-linear regression and will often fall more sharply than a smooth 4-parameter non-linear curve.</p>
<div class="sourceCode" id="cb36"><pre class="downlit">
<span class="fu"><a href="../reference/ecx.html">ecx</a></span>(<span class="kw">exp_4</span>)
</pre></div>
<pre><code>##   ec_10_Q50  ec_10_Q2.5 ec_10_Q97.5 
##    63.20991    52.18468    71.76396</code></pre>
</div>
</div>
<div id="fitting-multiple-models-and-model-averaging-using-the-bnec-function" class="section level2">
<h2 class="hasAnchor">
<a href="#fitting-multiple-models-and-model-averaging-using-the-bnec-function" class="anchor"></a>Fitting multiple models and model averaging using the <code>bnec</code> function</h2>
<div id="fitting-a-bnec-model" class="section level3">
<h3 class="hasAnchor">
<a href="#fitting-a-bnec-model" class="anchor"></a>Fitting a <code>bnec</code> model</h3>
<p>So far we have explored how to fit individual models via the function <code>bnec</code>. The <code>bayesnec</code> package also has the capacity to fit a custom selection of models, pre-specified sets of models or even all the available models in the package. Note that as these are Bayesian methods requiring multiple MCMC chains using <code>bnec</code> can be very slow. See details under <code><a href="../reference/bnec.html">?bnec</a></code> for more information on the models, and model sets that can be specified.</p>
<div class="sourceCode" id="cb38"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">333</span>)
<span class="kw">exp_5</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bnec.html">bnec</a></span>(data = <span class="kw">prop_data</span>, x_var = <span class="st">"raw_x"</span>,
               y_var = <span class="st">"resp"</span>, model = <span class="st">"all"</span>)
<span class="co"># save(exp_5, file = "exp_5.RData")</span>
</pre></div>
<p>Here we run <code>bnec</code> using <code>model =  "all"</code> using the proportional data example for a beta response variable from above, and save the output as an <code>.RData</code> file so that the rmarkdown will not include all of the console output that is generated when these models run. Saving an <code>.RData</code> file of the <em>all</em> model <code>bnec</code> output can be a useful way of fitting all the models at a convenient time (this can be very slow, so you can run this overnight for example) so you can reload them later to explore, plot, extract values, and amend the model set as required.</p>
</div>
<div id="exploring-a-bayesmanecfit-model" class="section level3">
<h3 class="hasAnchor">
<a href="#exploring-a-bayesmanecfit-model" class="anchor"></a>Exploring a <code>bayesmanecfit</code> model</h3>
<p>We have created some plotting method functions for our <code>bayesnec</code> model types, so we can plot a <code>bayesmanecfit</code> model object simply with <code>plot</code>.</p>
<div class="sourceCode" id="cb39"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span>(<span class="kw">exp_5</span>)
</pre></div>
<p><img src="example_files/figure-html/unnamed-chunk-25-1.png" width="672"></p>
<p>The default plot looks exactly the same out our regular <code>bayesnecfit</code> plot, but the output is based in a weighted average of all the models fits. The <em>NEC</em> estimate on this plot is based on a mix of actual <em>NEC</em> estimates, as well as the <em>NSEC</em> estimates that are used as an approximation to <em>NEC</em> for all the <code>ecx</code> models in the set. Note that we do not currently recommend reporting this values as the <em>NEC</em> (see below). The fitted <code>bayesmanecfit</code> object contains different elements to the <code>bayesnecfit</code>. In particular</p>
<div class="sourceCode" id="cb40"><pre class="downlit">
<span class="kw">exp_5</span><span class="op">$</span><span class="kw">mod_stats</span>
</pre></div>
<pre><code>##               model      waic           wi dispersion_Estimate dispersion_Q2.5
## nec3param nec3param -433.0652 1.808073e-01                  NA              NA
## nec4param nec4param -434.5496 3.628005e-01                  NA              NA
## necsigm     necsigm -433.5030 2.005509e-04                  NA              NA
## ecxlin       ecxlin -373.8984 1.071960e-05                  NA              NA
## ecxexp       ecxexp -360.5721 7.698952e-02                  NA              NA
## ecxsigm     ecxsigm -421.0199 3.205774e-07                  NA              NA
## ecx4param ecx4param -433.5130 4.819847e-06                  NA              NA
## ecxwb1       ecxwb1 -433.1202 1.190291e-03                  NA              NA
## ecxwb2       ecxwb2 -433.4358 3.779960e-01                  NA              NA
##           dispersion_Q97.5
## nec3param               NA
## nec4param               NA
## necsigm                 NA
## ecxlin                  NA
## ecxexp                  NA
## ecxsigm                 NA
## ecx4param               NA
## ecxwb1                  NA
## ecxwb2                  NA</code></pre>
<p>contains the table of model fit statistic for all the fitted models. This includes the model name, the WAIC (as returned from <code>brms</code>), WAIC.delta (WAIC - the lowest WAIC), wi (the model weight), pD, and the over-dispersion estimate. For this example, three models have relatively similar weights and contribute to the model averaged outcome, including the <code>nec3param</code>, <code>nec4param</code> and the <code>ecx4param</code> models, with the <code>nec4param</code> being overall the highest.</p>
<p>The <code>bayesmanecfit</code> object also contains all of the original fits, which can be extracted using the <code>pull_out</code> function.</p>
<div class="sourceCode" id="cb42"><pre class="downlit">
<span class="kw">exp_5_nec3param</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pull_out.html">pull_out</a></span>(<span class="kw">exp_5</span>, model = <span class="st">"nec3param"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span>(<span class="kw">exp_5_nec3param</span>)
</pre></div>
<p><img src="example_files/figure-html/unnamed-chunk-27-1.png" width="672"></p>
<p>This would extract the <code>nec3param</code> model from the <code>bayesmanecfit</code> and create a new object that contains just this <code>bayesnecfit</code> fit. This would be identical to fitting the <code>nec3param</code> as a single model using <code>bnec</code> as we did above. All of the models in the <code>bayesmanecfit</code> can be simultaneously plotted using</p>
<div class="sourceCode" id="cb43"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span>(<span class="kw">exp_5</span>, all_models = <span class="fl">TRUE</span>)
</pre></div>
<p><img src="example_files/figure-html/unnamed-chunk-28-1.png" width="672"></p>
<p>The models prefixed with <code>ecx</code> are all models that do not have the <em>NEC</em> as a parameter in the model. That is they are smooth curves as a function of concentration and have no breakpoint. The <em>NEC</em> on the plot above for these models are an approximation based on <em>NSEC</em> (see above) and should not be used without careful consideration of the validity of this endpoint value. A formal model averaged estimate of <em>NEC</em> should be obtained with <code>model = "NEC"</code>, and there is a helper function <code>amend</code> that can be used to alter the model set as required. We can use this to obtain first a set of <em>NEC</em> only models</p>
<div class="sourceCode" id="cb44"><pre class="downlit">
<span class="kw">exp_5_nec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pull_out.html">pull_out</a></span>(<span class="kw">exp_5</span>, model = <span class="st">"nec"</span>)
</pre></div>
<p>We can drop other models from the set if desired, for example let’s drop the nechormesis model using the <code>amend</code> function</p>
<div class="sourceCode" id="cb45"><pre class="downlit">
<span class="kw">exp_5_nec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/amend.html">amend</a></span>(<span class="kw">exp_5_nec</span>, drop = <span class="st">"nechorme"</span>)
</pre></div>
<p>Now we have two model sets, an <em>NEC</em> set and a mixed <em>NEC</em> and <em>ECx</em> set. Of course before we use this model set for any inference, we would need to check the chain mixing and acf plot for each of the input models. For the all set, the models this highest weight are ecx4param and ecxwb1. We can assess the chains for these models to make sure they are good.</p>
<div class="sourceCode" id="cb46"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span>(<span class="kw">exp_5</span><span class="op">$</span><span class="kw">mod_fits</span><span class="op">$</span><span class="kw">ecx4param</span><span class="op">$</span><span class="kw">fit</span>)
</pre></div>
<p><img src="example_files/figure-html/unnamed-chunk-31-1.png" width="672"></p>
<div class="sourceCode" id="cb47"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span>(<span class="kw">exp_5</span><span class="op">$</span><span class="kw">mod_fits</span><span class="op">$</span><span class="kw">ecxwb1</span><span class="op">$</span><span class="kw">fit</span>)
</pre></div>
<p><img src="example_files/figure-html/unnamed-chunk-32-1.png" width="672"></p>
<p>Now we can use the <code>ecx</code> function to get EC10 and ec50 values. We can do this using our all model set, because it is valid to use <em>NEC</em> models for estimating <em>ECx</em>.</p>
<div class="sourceCode" id="cb48"><pre class="downlit">
<span class="kw">ECx10</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ecx.html">ecx</a></span>(<span class="kw">exp_5</span>, ecx_val = <span class="fl">10</span>)
<span class="kw">ECx50</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ecx.html">ecx</a></span>(<span class="kw">exp_5</span>, ecx_val = <span class="fl">50</span>)

<span class="kw">ECx10</span>
</pre></div>
<pre><code>##    ec_10 ec_10_lw ec_10_up 
## 3.408857 1.190443 3.733920</code></pre>
<div class="sourceCode" id="cb50"><pre class="downlit">
<span class="kw">ECx50</span>
</pre></div>
<pre><code>##    ec_50 ec_50_lw ec_50_up 
## 5.707110 5.672893 5.707110</code></pre>
<p>The weighted <em>NEC</em> estimates can be extracted directly from the <em>NEC</em> model set object, as they are an explicit parameter in these models.</p>
<div class="sourceCode" id="cb52"><pre class="downlit">
<span class="kw">NECvals</span> <span class="op">&lt;-</span> <span class="kw">exp_5_nec</span><span class="op">$</span><span class="kw">w_nec</span>
<span class="kw">NECvals</span>
</pre></div>
<pre><code>## Estimate     Q2.5    Q97.5 
## 3.035381 2.667209 3.286535</code></pre>
<p>Now we can make a combined plot of our output, showing the model averaged “<em>NEC</em>” model and the “all averaged model”, along with the relevant thresholds.</p>
<div class="sourceCode" id="cb54"><pre class="downlit">
<span class="kw">preds</span> <span class="op">&lt;-</span> <span class="kw">exp_5_nec</span><span class="op">$</span><span class="kw">w_pred_vals</span><span class="op">$</span><span class="kw">data</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span>(<span class="kw">exp_5</span>, add_nec = <span class="fl">FALSE</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span>(v = <span class="kw">ECx10</span>, col = <span class="st">"orange"</span>, lty = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">3</span>))
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span>(v = <span class="kw">ECx50</span>, col = <span class="st">"blue"</span>, lty = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">3</span>))
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span>(v = <span class="kw">NECvals</span>, col = <span class="st">"darkgrey"</span>, lty = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">3</span>, <span class="fl">1</span>, <span class="fl">3</span>))
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(<span class="kw">preds</span><span class="op">$</span><span class="kw">x</span>, <span class="kw">preds</span><span class="op">$</span><span class="kw">Estimate</span>, col = <span class="st">"darkgrey"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(<span class="kw">preds</span><span class="op">$</span><span class="kw">x</span>, <span class="kw">preds</span><span class="op">$</span><span class="kw">Q2.5</span>, col = <span class="st">"darkgrey"</span>, lty = <span class="fl">3</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(<span class="kw">preds</span><span class="op">$</span><span class="kw">x</span>, <span class="kw">preds</span><span class="op">$</span><span class="kw">Q97.5</span>, col = <span class="st">"darkgrey"</span>, lty = <span class="fl">3</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span>(<span class="st">"bottomleft"</span>,
  legend = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Complete averaged model"</span>, <span class="st">"EC10"</span>, <span class="st">"ec50"</span>, <span class="st">"NEC"</span>),
  col = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"black"</span>, <span class="st">"orange"</span>, <span class="st">"blue"</span>, <span class="st">"darkgrey"</span>), lty = <span class="fl">1</span>, bty = <span class="st">"n"</span>
)
</pre></div>
<p><img src="example_files/figure-html/unnamed-chunk-35-1.png" width="672"></p>
</div>
</div>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references">
<div id="ref-Burnham2002">
<p>Burnham, K P, and D R Anderson. 2002. <em>Model Selection and Multimodel Inference; A Practical Information-Theoretic Approach</em>. 2nd ed. New York: Springer.</p>
</div>
<div id="ref-Burkner2017">
<p>Bürkner, Paul Christian. 2017. “brms: An R package for Bayesian multilevel models using Stan.” <em>Journal of Statistical Software</em>. <a href="https://doi.org/10.18637/jss.v080.i01">https://doi.org/10.18637/jss.v080.i01</a>.</p>
</div>
<div id="ref-Fisher2020">
<p>Fisher, Rebecca, Gerard Ricardo, and David Fox. 2020. “Bayesian concentration-response modelling using jagsNEC.” <a href="https://doi.org/10.5281/ZENODO.3966864">https://doi.org/10.5281/ZENODO.3966864</a>.</p>
</div>
<div id="ref-Fox2010">
<p>Fox, David R. 2010. “A Bayesian approach for determining the no effect concentration and hazardous concentration in ecotoxicology.” <em>Ecotoxicology and Environmental Safety</em> 73 (2): 123–31.</p>
</div>
<div id="ref-Plummer2003">
<p>Plummer, Martyn. 2003. “ JAGS: A program for analysis of Bayesian graphical models using Gibbs sampling. http://citeseer.ist.psu.edu/plummer03jags.html.”</p>
</div>
<div id="ref-Ritz2016">
<p>Ritz, Christian, Florent Baty, Jens C Streibig, and Daniel Gerhard. 2016. “Dose-Response Analysis Using R.” <em>PLoS ONE</em> 10 (12): e0146021. <a href="https://doi.org/10.1371/journal.pone.0146021">https://doi.org/10.1371/journal.pone.0146021</a>.</p>
</div>
<div id="ref-Su2015">
<p>Su, Yu-Sung, and Masanao Yajima. 2015. “R2jags: Using R to Run ’JAGS’. R package version 0.5-6. http://CRAN.R-project.org/package=R2jags.”</p>
</div>
<div id="ref-Thorley2018">
<p>Thorley, Joe, and Carl Schwarz. 2018. “ssdtools: Species Sensitivity Distributions. R package version 0.0.3. https://CRAN.R-project.org/package=ssdtools.”</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Rebecca Fisher, Diego Barneche, Gerard Ricardo, David Fox.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
