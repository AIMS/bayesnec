<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Comparing posterior predictions • bayesnec</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Comparing posterior predictions">
<meta property="og:description" content="bayesnec">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">bayesnec</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/example1.html">Single model usage</a>
    </li>
    <li>
      <a href="../articles/example2.html">Multi model usage</a>
    </li>
    <li>
      <a href="../articles/example3.html">User-specified priors</a>
    </li>
    <li>
      <a href="../articles/example4.html">Comparing posterior predictions</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/open-aims/bayesnec/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="example4_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Comparing posterior predictions</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/open-aims/bayesnec/blob/master/vignettes/example4.Rmd"><code>vignettes/example4.Rmd</code></a></small>
      <div class="hidden name"><code>example4.Rmd</code></div>

    </div>

    
    
<div id="overview" class="section level1">
<h1 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h1>
<p>With <code>bayesnec</code> we have included a function that allows bootstrapped comparisons of posterior predictions. The main focus here is to showcase how the user can fit several different <code>bnec</code> model fits and can compare differences in the posterior predictions across these fits for individual endpoint estimates (e.g. nec, nsec or ecx) or across a range of predictor (x) values. Below we demonstrate usage of <code>compare_posterior</code> for objects of class <code>bayesnecfit</code> and <code>bayesmanecfit</code>. In this example we compare different types of models and model sets using a single dataset. However, the intent of this function is to allow comparison across different datasets that might represent, for example, different levels of a fixed factor covariate. At this time <code>bnec</code> does not allow interaction with a fixed factor. While this may be introduced in future releases the complexity of defining all possible model combinations at each factor level means that the greatest flexibility in the functional form of individual model fits can be much more readily obtained using individual model fits.</p>
<div id="comparing-posterior-endpoint-values" class="section level2">
<h2 class="hasAnchor">
<a href="#comparing-posterior-endpoint-values" class="anchor"></a>Comparing posterior endpoint values</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/paul-buerkner/brms">brms</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://open-aims.github.io/bayesnec">bayesnec</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">nec_data</span><span class="op">)</span>

<span class="co"># Fit a set of models</span>
<span class="va">exmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bnec.html">bnec</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">nec_data</span>, x_var <span class="op">=</span> <span class="st">"x"</span>, y_var <span class="op">=</span> <span class="st">"y"</span>,
               model <span class="op">=</span> <span class="st">"all"</span>,
               family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/brms/man/brmsfamily.html">Beta</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span>,
               wi_method <span class="op">=</span> <span class="st">"pseudobma"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">exmp</span><span class="op">)</span> <span class="co"># bayesmanecfit</span></code></pre></div>
<p>This call fits all models that are suitable for modelling beta response data using a logit link. We can pull out the <strong>nec</strong> models and the <strong>ecx</strong> models separately, to create two more alternative versions for fitting this data.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">exmp_nec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pull_out.html">pull_out</a></span><span class="op">(</span><span class="va">exmp</span>, model <span class="op">=</span> <span class="st">"nec"</span><span class="op">)</span>
<span class="va">exmp_ecx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pull_out.html">pull_out</a></span><span class="op">(</span><span class="va">exmp</span>, model <span class="op">=</span> <span class="st">"ecx"</span><span class="op">)</span></code></pre></div>
<p>Now we have three different averaged model fits, all of class <code>bayemanec</code> in this case (because they all contain multiple fits). We can compare their posterior estimates of the ex10 values using <code>compare_posterior</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="va">post_comp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compare_posterior.html">compare_posterior</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"all"</span> <span class="op">=</span> <span class="va">exmp</span>, <span class="st">"ecx"</span> <span class="op">=</span> <span class="va">exmp_ecx</span>, <span class="st">"nec"</span> <span class="op">=</span> <span class="va">exmp_nec</span><span class="op">)</span>, comparison <span class="op">=</span> <span class="st">"ecx"</span>, ecx_val <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">post_comp</span><span class="op">)</span>
<span class="co"># "posterior_list" </span>
<span class="co"># "posterior_data" </span>
<span class="co"># "diff_list"      </span>
<span class="co"># "diff_data"      </span>
<span class="co"># "prob_diff"</span></code></pre></div>
<p>The <code>compare_posterior</code> function outputs several elements in a named list. This includes the posterior_data for each model in the comparison as a <code>data.frame</code>which we can use to plot a <code>geom_density</code> plot of the posterior estimates.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">post_comp</span><span class="op">$</span><span class="va">posterior_data</span>, <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_density</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>group<span class="op">=</span><span class="va">model</span>, colour<span class="op">=</span><span class="va">model</span>, fill <span class="op">=</span> <span class="va">model</span><span class="op">)</span>, alpha<span class="op">=</span><span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span> </code></pre></div>
<p><img src="example4a.jpeg" width="100%"> The <code>data.frame</code> “diff_data” can be used to make a similar plot, but specifically for the differences among models.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">post_comp</span><span class="op">$</span><span class="va">diff_data</span>, <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">diff</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_density</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>group<span class="op">=</span><span class="va">comparison</span>, colour<span class="op">=</span><span class="va">comparison</span>, fill <span class="op">=</span> <span class="va">comparison</span><span class="op">)</span>, alpha<span class="op">=</span><span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span> </code></pre></div>
<p><img src="example4b.jpeg" width="100%"></p>
<p>Finally, the the probability matrix that the endpoint estimate for one mode is greater than the other is obtained in “prob_diff”</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">post_comp</span><span class="op">$</span><span class="va">prob_diff</span>
<span class="co">#        all    ecx    nec</span>
<span class="co"># all 1.0000 0.9730 0.5020</span>
<span class="co"># ecx 0.0325 1.0000 0.0365</span>
<span class="co"># nec 0.5350 0.9675 1.0000</span></code></pre></div>
</div>
<div id="comparing-posterior-fitted-values" class="section level2">
<h2 class="hasAnchor">
<a href="#comparing-posterior-fitted-values" class="anchor"></a>Comparing posterior fitted values</h2>
<p>The user can also compare posterior fitted values across the full range of x values, using <code>comparison = "fitted"</code></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://open-aims.github.io/bayesnec">bayesnec</a></span><span class="op">)</span>
<span class="va">post_comp_fitted</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compare_posterior.html">compare_posterior</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"all"</span> <span class="op">=</span> <span class="va">exmp</span>, <span class="st">"ecx"</span> <span class="op">=</span> <span class="va">exmp_ecx</span>, <span class="st">"nec"</span> <span class="op">=</span> <span class="va">exmp_nec</span><span class="op">)</span>, comparison <span class="op">=</span> <span class="st">"fitted"</span>, precision <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></code></pre></div>
<p>In the case of <code>comparison = "fitted"</code> most of the elements returned by compare_posterior are class <code>data.frame</code>, with summary values for the posteriors, difference values and probabilities returned for each value of x, for each model, or model comparison.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="kw">head</span>(post_comp_fitted<span class="op">$</span>posterior_data)</span>
<span id="cb8-2"><a href="#cb8-2"></a>  model          x  Estimate      Q2<span class="fl">.5</span>     Q97<span class="fl">.5</span></span>
<span id="cb8-3"><a href="#cb8-3"></a><span class="co"># 1   all 0.03234801 0.8885559 0.8718261 0.8991815</span></span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="co"># 2   all 0.09741274 0.8885995 0.8733894 0.8991821</span></span>
<span id="cb8-5"><a href="#cb8-5"></a><span class="co"># 3   all 0.16247747 0.8886515 0.8745928 0.8991952</span></span>
<span id="cb8-6"><a href="#cb8-6"></a><span class="co"># 4   all 0.22754220 0.8887310 0.8759464 0.8991952</span></span>
<span id="cb8-7"><a href="#cb8-7"></a><span class="co"># 5   all 0.29260692 0.8888061 0.8767969 0.8992226</span></span>
<span id="cb8-8"><a href="#cb8-8"></a><span class="co"># 6   all 0.35767165 0.8888948 0.8775943 0.8992401</span></span>
<span id="cb8-9"><a href="#cb8-9"></a></span>
<span id="cb8-10"><a href="#cb8-10"></a><span class="kw">head</span>(post_comp_fitted<span class="op">$</span>diff_data)</span>
<span id="cb8-11"><a href="#cb8-11"></a><span class="co">#            x comparison   prob diff.Estimate    diff.Q2.5  diff.Q97.5</span></span>
<span id="cb8-12"><a href="#cb8-12"></a><span class="co"># 1 0.03234801    ecx-all 0.9185   0.012593751 -0.004832162 0.032435951</span></span>
<span id="cb8-13"><a href="#cb8-13"></a><span class="co"># 2 0.03234801    nec-all 0.5595   0.001079684 -0.013983908 0.019867356</span></span>
<span id="cb8-14"><a href="#cb8-14"></a><span class="co"># 3 0.03234801    nec-ecx 0.0940  -0.011610798 -0.027872420 0.005847878</span></span>
<span id="cb8-15"><a href="#cb8-15"></a><span class="co"># 4 0.09741274    ecx-all 0.9125   0.011564489 -0.005086656 0.031355968</span></span>
<span id="cb8-16"><a href="#cb8-16"></a><span class="co"># 5 0.09741274    nec-all 0.5575   0.001122890 -0.014437448 0.018929807</span></span>
<span id="cb8-17"><a href="#cb8-17"></a><span class="co"># 6 0.09741274    nec-ecx 0.0970  -0.010600105 -0.026747137 0.005956780</span></span></code></pre></div>
<p>We can plot the predicted curves with confience bounds for each of the input models</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">post_comp_fitted</span><span class="op">$</span><span class="va">posterior_data</span><span class="op">)</span> <span class="op">+</span>
<span class="fu">geom_line</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">Estimate</span>, color<span class="op">=</span> <span class="va">model</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span>
<span class="fu">geom_ribbon</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, ymin<span class="op">=</span><span class="va">Q2.5</span>, ymax<span class="op">=</span><span class="va">Q97.5</span>, fill<span class="op">=</span><span class="va">model</span><span class="op">)</span>, alpha<span class="op">=</span><span class="fl">0.3</span><span class="op">)</span> </code></pre></div>
<p><img src="example4c.jpeg" width="100%"></p>
<p>We can plot the differences between pairs of models in the list</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">post_comp_fitted</span><span class="op">$</span><span class="va">diff_data</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_line</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, <span class="va">diff.Estimate</span>, color<span class="op">=</span><span class="va">comparison</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_ribbon</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, ymin<span class="op">=</span><span class="va">diff.Q2.5</span>, ymax<span class="op">=</span><span class="va">diff.Q97.5</span>, fill<span class="op">=</span><span class="va">comparison</span><span class="op">)</span>, alpha<span class="op">=</span><span class="fl">0.3</span><span class="op">)</span> </code></pre></div>
<p><img src="example4d.jpeg" width="100%"></p>
<p>And finally we can plot the probability that one model is greater than the other</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">post_comp_fitted</span><span class="op">$</span><span class="va">diff_data</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_line</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, <span class="va">prob</span>, color<span class="op">=</span><span class="va">comparison</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span></code></pre></div>
<p><img src="example4e.jpeg" width="100%"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Rebecca Fisher, Diego Barneche, Gerard Ricardo, David Fox.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
